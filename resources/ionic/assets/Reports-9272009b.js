import{d as B,r as f,o as y,c as D,w as t,a,u as e,I as x,b as E,e as g,f as M,g as p,h as S,i as U,j as $,k as N,l as O,m,n as q,p as K,q as k,s as b,t as F,v as I,x as V,y as T,z as C,A as P,B as z,C as A,D as H,E as j,F as G,G as J,H as Q,J as W,K as R}from"./index-300ccdc8.js";import{R as L,S as X}from"./RequestAPI-525527de.js";import{D as Y,E as Z,a as r,U as w,b as ee}from"./datetime-560c2bd1.js";const te=["disabled"],ae=["disabled"],le=B({__name:"NewReport",props:{emitter:{type:Y,required:!0}},setup(h){const c=h,d=f(!1),o=f({title:"",type:Z.Bill,startDate:r.now().set({day:1}).toFormat("dd/MM/yyyy").toString(),endDate:r.now().set({day:1}).plus({month:1}).minus({day:1}).toFormat("dd/MM/yyyy").toString()}),v=async()=>{var s;const n=_();if(!n.isValid){C.create({header:"Oops...",message:n.errors[0],buttons:["OK"]}).then(l=>{l.present()});return}d.value=!0,L.post("/reports",{user_id:(s=await X.getCurrentSession())==null?void 0:s.id(),title:o.value.title,type:o.value.type,from_date:r.fromFormat(o.value.startDate,"dd/MM/yyyy").toISO(),to_date:r.fromFormat(o.value.endDate,"dd/MM/yyyy").toISO(),status:"Draft"}).then(l=>{c.emitter.fire("created",{...l.report}),P.create({message:"Reporte creado con exito!",duration:2e3}).then(u=>{u.present()}),c.emitter.fire("close")}).catch(l=>{C.create({header:"Oops...",message:l.response.message,buttons:["OK"]}).then(u=>{u.present()})}).finally(()=>{d.value=!1})},_=()=>{let n=[];o.value.title.trim().length==0&&n.push("El nombre del reporte no puede estar vacío");const s=r.fromFormat(o.value.startDate,"dd/MM/yyyy").isValid,l=r.fromFormat(o.value.endDate,"dd/MM/yyyy").isValid;if(s||n.push(r.fromFormat(o.value.startDate,"dd/MM/yyyy").invalidExplanation),l||n.push(r.fromFormat(o.value.endDate,"dd/MM/yyyy").invalidExplanation),s&&l){const u=r.fromFormat(o.value.startDate,"dd/MM/yyyy"),i=r.fromFormat(o.value.endDate,"dd/MM/yyyy");u>i&&n.push("La fecha de inicio no puede ser mayor a la fecha de término")}return{isValid:n.length==0,errors:n}};return(n,s)=>(y(),D(e(T),null,{default:t(()=>[a(e(x),null,{default:t(()=>[a(e(E),null,{default:t(()=>[a(e(g),{slot:"start"},{default:t(()=>[a(e(M),{onClick:s[0]||(s[0]=l=>c.emitter.fire("close"))},{default:t(()=>[p("Cancelar")]),_:1})]),_:1}),a(e(S),null,{default:t(()=>[p("Nuevo Reporte")]),_:1}),a(e(g),{slot:"end"},{default:t(()=>[a(e(M),{onClick:v},{default:t(()=>[p("Crear")]),_:1})]),_:1}),d.value?(y(),D(e(U),{key:0,type:"indeterminate"})):$("",!0)]),_:1})]),_:1}),a(e(N),null,{default:t(()=>[a(e(O),{inset:!0},{default:t(()=>[a(e(m),null,{default:t(()=>[a(e(q),{label:"Nombre del reporte","label-placement":"stacked",placeholder:"Nombre del reporte",modelValue:o.value.title,"onUpdate:modelValue":s[1]||(s[1]=l=>o.value.title=l),disabled:d.value},null,8,["modelValue","disabled"])]),_:1}),a(e(m),null,{default:t(()=>[a(e(K),{label:"Tipo de documento","label-placement":"stacked",interface:"action-sheet",modelValue:o.value.type,"onUpdate:modelValue":s[2]||(s[2]=l=>o.value.type=l),disabled:d.value},{default:t(()=>[a(e(k),{value:"Bill"},{default:t(()=>[p("Boletas")]),_:1}),a(e(k),{value:"Facture"},{default:t(()=>[p("Facturas")]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),a(e(m),null,{default:t(()=>[a(e(b),{position:"stacked"},{default:t(()=>[p("Fecha de Inicio")]),_:1}),F(I("input",{class:"native-input sc-ion-input-ios","data-maska":"##/##/####","onUpdate:modelValue":s[3]||(s[3]=l=>o.value.startDate=l),disabled:d.value},null,8,te),[[e(w)],[V,o.value.startDate]])]),_:1}),a(e(m),null,{default:t(()=>[a(e(b),{position:"stacked"},{default:t(()=>[p("Fecha de Término")]),_:1}),F(I("input",{class:"native-input sc-ion-input-ios","data-maska":"##/##/####","onUpdate:modelValue":s[4]||(s[4]=l=>o.value.endDate=l),disabled:d.value},null,8,ae),[[e(w)],[V,o.value.endDate]])]),_:1})]),_:1})]),_:1})]),_:1}))}}),de=B({__name:"Reports",setup(h){const c=f([]),d=f(!0),o=z(),v=f(null),_=async()=>{const l=await L.get("/reports");d.value=!1,c.value=l},n=l=>{o.push("/reports/".concat(l))},s=async()=>{ee.show(le,{onLoaded(l){l.on("created",u=>{const i=u.data.id;n(i),_()})},modalControllerOptions:{presentingElement:v,showBackdrop:!0}})};return _(),(l,u)=>(y(),D(e(T),{ref_key:"page",ref:v},{default:t(()=>[a(e(x),null,{default:t(()=>[a(e(E),null,{default:t(()=>[a(e(S),null,{default:t(()=>[p("Mis Reportes")]),_:1})]),_:1})]),_:1}),a(e(N),null,{default:t(()=>[a(e(A),{slot:"fixed",vertical:"bottom",horizontal:"end",edge:!1},{default:t(()=>[a(e(H),{onClick:s},{default:t(()=>[a(e(j),{icon:e(G)},null,8,["icon"])]),_:1})]),_:1}),a(e(O),null,{default:t(()=>[(y(!0),J(W,null,Q(c.value,i=>(y(),D(e(m),{key:i.id,button:"",onClick:oe=>n(i.id),detail:!0},{default:t(()=>[a(e(b),null,{default:t(()=>[I("h2",null,R(i.title),1),I("h3",null,R(i.status),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},512))}});export{de as default};
