import{d as U,r as M,o as d,c as _,w as t,a,u as e,I as j,b as q,e as E,f as R,g as p,h as H,i as K,j as v,k as z,l as F,m as g,n as W,p as X,q as B,s as D,t as w,v as r,x,y as G,z as O,R as J,S as Y,A as Z,B as ee,C as te,D as ae,E as le,F as I,G as ne,H as k,J as T,K as L,L as N,M as oe,N as f,O as C,P as $,Q as A}from"./index-32b16346.js";import{D as se,E as ue,U as P,a as re}from"./ReportInterfaces-e29644ef.js";import{D as c}from"./datetime-49c8e94e.js";const ie="/app/assets/report-633412c4.svg",de=["disabled"],ce=["disabled"],pe=U({__name:"NewReport",props:{emitter:{type:se,required:!0}},setup(V){const h=V,y=M(!1),n=M({title:"",type:ue.Bill,startDate:c.now().set({day:1}).toFormat("dd/MM/yyyy").toString(),endDate:c.now().set({day:1}).plus({month:1}).minus({day:1}).toFormat("dd/MM/yyyy").toString()}),S=async()=>{var o;const m=b();if(!m.isValid){O.create({header:"Oops...",message:m.errors[0],buttons:["OK"]}).then(s=>{s.present()});return}y.value=!0,J.post("/reports",{user_id:(o=await Y.getCurrentSession())==null?void 0:o.id(),title:n.value.title,type:n.value.type,from_date:c.fromFormat(n.value.startDate,"dd/MM/yyyy").toISO(),to_date:c.fromFormat(n.value.endDate,"dd/MM/yyyy").toISO(),status:"Draft"}).then(s=>{h.emitter.fire("created",{...s.report}),Z.create({message:"Reporte creado con exito!",duration:2e3}).then(i=>{i.present()}),h.emitter.fire("close")}).catch(s=>{O.create({header:"Oops...",message:s.response.message,buttons:["OK"]}).then(i=>{i.present()})}).finally(()=>{y.value=!1})},b=()=>{let m=[];n.value.title.trim().length==0&&m.push("El nombre del reporte no puede estar vacío");const o=c.fromFormat(n.value.startDate,"dd/MM/yyyy").isValid,s=c.fromFormat(n.value.endDate,"dd/MM/yyyy").isValid;if(o||m.push(c.fromFormat(n.value.startDate,"dd/MM/yyyy").invalidExplanation),s||m.push(c.fromFormat(n.value.endDate,"dd/MM/yyyy").invalidExplanation),o&&s){const i=c.fromFormat(n.value.startDate,"dd/MM/yyyy"),u=c.fromFormat(n.value.endDate,"dd/MM/yyyy");i>u&&m.push("La fecha de inicio no puede ser mayor a la fecha de término")}return{isValid:m.length==0,errors:m}};return(m,o)=>(d(),_(e(G),null,{default:t(()=>[a(e(j),null,{default:t(()=>[a(e(q),null,{default:t(()=>[a(e(E),{slot:"start"},{default:t(()=>[a(e(R),{onClick:o[0]||(o[0]=s=>h.emitter.fire("close"))},{default:t(()=>[p("Cancelar")]),_:1})]),_:1}),a(e(H),null,{default:t(()=>[p("Nuevo Reporte")]),_:1}),a(e(E),{slot:"end"},{default:t(()=>[a(e(R),{onClick:S},{default:t(()=>[p("Crear")]),_:1})]),_:1}),y.value?(d(),_(e(K),{key:0,type:"indeterminate"})):v("",!0)]),_:1})]),_:1}),a(e(z),null,{default:t(()=>[a(e(F),{inset:!0},{default:t(()=>[a(e(g),null,{default:t(()=>[a(e(W),{label:"Nombre del reporte","label-placement":"stacked",placeholder:"Nombre del reporte",modelValue:n.value.title,"onUpdate:modelValue":o[1]||(o[1]=s=>n.value.title=s),disabled:y.value},null,8,["modelValue","disabled"])]),_:1}),a(e(g),null,{default:t(()=>[a(e(X),{label:"Tipo de documento","label-placement":"stacked",interface:"action-sheet",modelValue:n.value.type,"onUpdate:modelValue":o[2]||(o[2]=s=>n.value.type=s),disabled:y.value},{default:t(()=>[a(e(B),{value:"Bill"},{default:t(()=>[p("Boletas")]),_:1}),a(e(B),{value:"Facture"},{default:t(()=>[p("Facturas")]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),a(e(g),null,{default:t(()=>[a(e(D),{position:"stacked"},{default:t(()=>[p("Fecha de Inicio")]),_:1}),w(r("input",{class:"native-input sc-ion-input-ios","data-maska":"##/##/####","onUpdate:modelValue":o[3]||(o[3]=s=>n.value.startDate=s),disabled:y.value},null,8,de),[[e(P)],[x,n.value.startDate]])]),_:1}),a(e(g),null,{default:t(()=>[a(e(D),{position:"stacked"},{default:t(()=>[p("Fecha de Término")]),_:1}),w(r("input",{class:"native-input sc-ion-input-ios","data-maska":"##/##/####","onUpdate:modelValue":o[4]||(o[4]=s=>n.value.endDate=s),disabled:y.value},null,8,ce),[[e(P)],[x,n.value.endDate]])]),_:1})]),_:1})]),_:1})]),_:1}))}}),me={key:0},fe={key:1},ye={key:2,class:"ion-padding",style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"100%"}},_e=r("h2",null,"Aún no tienes reportes",-1),ve=r("p",{class:"ion-text-center"},'Crea tu primer reporte haciendo click en el botón "+" abajo',-1),ge=U({__name:"Reports",setup(V){const h=M([]),y=M(!0),n=ee(),S=M(null),b=te(()=>{const i=h.value.map(u=>({...u,reportType:u.type=="Bill"?"Boletas":"Facturas",reportStatus:u.status=="Draft"?"Pendiente":"Enviado",reportDates:"".concat(c.fromISO(u.from_date).toLocaleString(c.DATE_MED)," - ").concat(c.fromISO(u.to_date).toLocaleString(c.DATE_MED)),invoices:{total:u.invoices.count,totalAmount:u.invoices.total_amount}}));return{drafts:i.filter(u=>u.status=="Draft"),submitted:i.filter(u=>u.status=="Submitted")}}),m=async()=>{const i=await J.get("/me/reports");y.value=!1,h.value=i},o=i=>{n.push("/reports/".concat(i))},s=async()=>{re.show(pe,{onLoaded(i){i.on("created",u=>{const l=u.data.id;o(l),m()})},modalControllerOptions:{presentingElement:S,showBackdrop:!0}})};return m(),(i,u)=>(d(),_(e(G),{ref_key:"page",ref:S},{default:t(()=>[a(e(j),null,{default:t(()=>[a(e(q),null,{default:t(()=>[a(e(H),null,{default:t(()=>[p("Mis Reportes")]),_:1}),y.value?(d(),_(e(K),{key:0,type:"indeterminate"})):v("",!0)]),_:1})]),_:1}),a(e(z),null,{default:t(()=>[a(e(ae),{slot:"fixed",vertical:"bottom",horizontal:"end",edge:!1},{default:t(()=>[a(e(le),{onClick:s},{default:t(()=>[a(e(I),{icon:e(ne)},null,8,["icon"])]),_:1})]),_:1}),b.value.drafts.length>0?(d(),k("article",me,[a(e(T),null,{default:t(()=>[p("Pendientes")]),_:1}),a(e(F),null,{default:t(()=>[(d(!0),k(L,null,N(b.value.drafts,l=>(d(),_(e(g),{key:l.id,button:"",onClick:Q=>o(l.id),detail:!0},{default:t(()=>[a(e(D),null,{default:t(()=>[r("h2",null,[r("b",null,f(l.title),1)]),r("p",null,f(l.reportType),1),r("p",null,f(l.reportDates),1),r("p",null,[r("b",null,"S./ "+f(l.invoices.totalAmount),1)])]),_:2},1024),l.status=="Draft"?(d(),_(e(C),{key:0,color:"danger"},{default:t(()=>[a(e(I),{icon:e($)},null,8,["icon"]),a(e(D),null,{default:t(()=>[p(f(l.reportStatus),1)]),_:2},1024)]),_:2},1024)):v("",!0),l.status=="Submitted"?(d(),_(e(C),{key:1,color:"success"},{default:t(()=>[a(e(I),{icon:e(A)},null,8,["icon"]),a(e(D),null,{default:t(()=>[p(f(l.reportStatus),1)]),_:2},1024)]),_:2},1024)):v("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):v("",!0),b.value.submitted.length>0?(d(),k("article",fe,[a(e(T),null,{default:t(()=>[p("Enviados")]),_:1}),a(e(F),null,{default:t(()=>[(d(!0),k(L,null,N(b.value.submitted,l=>(d(),_(e(g),{key:l.id,button:"",onClick:Q=>o(l.id),detail:!0},{default:t(()=>[a(e(D),null,{default:t(()=>[r("h2",null,[r("b",null,f(l.title),1)]),r("p",null,f(l.reportType),1),r("p",null,f(l.reportDates),1),r("p",null,[r("b",null,"S./ "+f(l.invoices.totalAmount),1)])]),_:2},1024),l.status=="Draft"?(d(),_(e(C),{key:0,color:"danger"},{default:t(()=>[a(e(I),{icon:e($)},null,8,["icon"]),a(e(D),null,{default:t(()=>[p(f(l.reportStatus),1)]),_:2},1024)]),_:2},1024)):v("",!0),l.status=="Submitted"?(d(),_(e(C),{key:1,color:"success"},{default:t(()=>[a(e(I),{icon:e(A)},null,8,["icon"]),a(e(D),null,{default:t(()=>[p(f(l.reportStatus),1)]),_:2},1024)]),_:2},1024)):v("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):v("",!0),!y.value&&h.value.length==0?(d(),k("article",ye,[a(e(oe),{src:e(ie),style:{width:"90%",margin:"0 auto"}},null,8,["src"]),_e,ve])):v("",!0)]),_:1})]),_:1},512))}});export{ge as default};
